# 范式 NF



## 概念

- 在关系型数据库中，关于数据表设计的基本原则、规则就称为范式。

- 目前关系型数据库有六种常见范式，按照范式级别，从低到高分别是：**第一范式（1NF）、第二范式 （2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美 范式）。**
- 实际开发中，最高也就遵循BCNF，普遍3NF，但不绝对。有时候为了提高性能，会破坏范式规则。

- 键和相关属性的概念（范式的定义会使用到主键和候选键，数据库中的键有一个或多个属性组成）

  - `超键`：能唯一标识元组的属性集叫做超键
  - `候选键`：如果超键不包含多余的属性，那么这个超键就是候选键
  - `主键`：用户可以从候选键中选择一个作为主键
  - `外键`：如果数据表R1中的某个属性集不是R1的主键，而是另一个表R2的主键，那么这个属性集就是数据表R1的外键
  - `主属性`：包含任意候选键中的属性称为主属性
  - `非主属性`：与主属性相对，指的是不包含在**任何**一个候选键中的属性

  通常，我们将候选键成为`码`，主键成为`主码`。

  

## 第一范式

- 确保数据表中的每个字段的值必须具有`原子性`，也就是每个字段的值为`不可拆分`的最小数据单元。



## 第二范式

- 在第一范式的基础上，满足数据表里的每一条数据记录，都是可以唯一标识的。而且所有非主键字段，都必须完全依赖主键，不能只依赖主键的一部分。
- 完全依赖，即如果知道主键所有属性的值，就可以检索到任何元组（行）的任何属性的任何值

- 1NF 告诉我们字段属性需要是原子性的，而 2NF 告诉我们一张表就是一个独立的对象，一张表只 表达一个意思。



## 第三范式

- 在第二范式的基础上，确保数据表中的每一个非主键字段和主键字段直接相关，也就是说，**要求数据表中的所有非主键字段不能依赖其他非主键字段。**非主属性之间不能有依赖关系，必须互相独立。



## 巴斯范式BCNF

- 若一个关系达到第三范式，并且它只有一个候选键，或者它的每个候选键都是单属性，则该关系自然达到BCNF



## 反范式化

- 正常反第二\三范式，不反第一范式
- 性能vs规范化
  1. 为满足某种商业目标 , 数据库性能比规范化数据库更重要
  2. 在数据规范化的同时 , 要综合考虑数据库的性能
  3. 通过在给定的表中添加额外的字段，以大量减少需要从中搜索信息所需的时间 
  4. 通过在给定的表中插入计算列，以方便查询

- 反范式问题
  1. 存储 空间变大 了 
  2. 一个表中字段做了修改，另一个表中冗余的字段也需要做同步修改，否则 **数据不一致** 
  3. 若采用存储过程来支持数据的更新、删除等额外操作，如果更新频繁，会非常 **消耗系统资源** 
  4. 在 数据量小 的情况下，反范式不能体现性能的优势，可能还会让数据库的设计更加 **复杂**

- 反范式的适用场景 
  - 当冗余信息有价值或者能 **大幅度提高查询效率** 的时候，我们才会采取反范式的优化。

