# 索引



## 索引概念

- 索引优化数据库查询速度的是一种**数据结构**
- InnoDB：B+树
  - B+树层数**越低**，IO次数**越少**
  - 一般情况下，我们用到的**B+树层数不会超过4层**





## 常见的索引

### 1. 聚簇索引

#### 概念

- 聚簇索引并不是一种单独的引用类型，而是**一种数据存储方式**（所有的用户都记录在了叶子节点），也就是所谓的 **索引即数据，数据即索引**

[^术语“聚簇”表示数据行和相邻的键值聚簇地存储在一起]: 

#### 特点

1. 使用记录主键值的大小进行记录和页的排序，这包括三个方面的含义：
   - **页内** 的记录是安装主键的大小排序成一个单向链表
   - 各个存放 **用户记录页** 也是根据页中用户记录的主键大小顺序排成一个**双向链表**
   - 存放 **目录项记录的页** 分为不同的层次，在同一层次中的页也是按照页中目录项记录的主键大小排序成一个 **双向链表**
2. B+树的**叶子节点存储**的是完整的用户记录
   - 所谓的完整用户记录，就是指的这个记录中存储了索引列的值（包括隐藏列）

- 我们把具有这两种特性的B+树称为聚簇索引，索引完整的用户记录都存放在这个聚簇索引的叶子节点处。这种聚簇索引并不需要我们在MySQL语句中显示地使用INDEX语句去创建，**InnoDB** 存储引擎会**自动**为我们**创建**聚簇索引。

#### 优点

- **数据访问更快**
- 聚簇索引对于主键的**排序查找和范围查找**速度非常快
- 节省了大量IO操作

#### 缺点

- 插入速度严重依赖于**插入顺序**。对于InnoDB表我们一般会定义一个自增的ID列为主键
- 更新主键的代价很高。在InnoDB表**主键**一般定义为为**不可更新**
- 二级索引访问需要两次索引查找，第一次找主键值，第二次根据主键值找行数据

#### 限制

- 目前只有InnoDB支持聚簇索引
- 每个MySQL的表只能有**一个聚簇索引**
- 如果定义主键，InnoDB会选择一个**非空且唯一索引**代替，如果没有，会隐式定义一个主键来作为聚簇索引
- InnoDB表的主键尽量选用有序的ID， 而不建议用无序的ID（比如UUID\MD5\HASH\字符串列）



### 2. 二级索引（辅助索引、非聚簇索引）